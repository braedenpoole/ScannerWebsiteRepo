<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <title>Scanner</title>

    </head>

    <body class="bg-white">
        <div>
            <!--Navbar-->
            <div id="indicesBar" class="fixed top-0 w-screen justify-center flex items-center space-x-8 h-14 px-5 lg:px-0 drop-shadow-xl bg-black" style="z-index: 999;">
                <!-- Navbar Logo and Hamburger Menu Icon -->
                <div class="items-center">
                    <div class="text-2xl text-white font-semibold hover:bg-gray-700">
                        <a href="https://www.braedenpoole.com/cryptoStats.html" class="px-6 py-2 hover:bg-gray-700" target="_blank">Home</a>
                    </div>
                </div>
                <!--Mobile Indicies-->
                <div id="menu-toggle" class="block md:hidden">
                    <button class="px-6 py-2 hover:bg-gray-700 font-semibold text-2xl">
                        <div class="text-white font-semibold">Indices</div>
                    </button>
                </div>

            
                <!-- Index Prices Container -->
                <div id="index-prices-container" class="hidden justify-end md:flex text-lg font-semibold md:space-x-3 lg:space-x-12 text-center pr-12">
                    <!-- Index prices will be populated here -->
                </div>
            </div>

            <div id="dropdown-index-container" class="pt-14 hidden justify-center w-full bg-black text-lg font-semibol text-center">
                <!-- Index prices will be populated here -->
            </div>
        </div>
        
        <section id="topPage" class="h-screen w-screen overflow-auto bg-gray-300 pt-14 flex justify-center items-center">
        
            <div id="allBoxes" class="h-3/4 w-5/6 md:h-5/6 bg-gray-300 flex justify-center items-center overflow-auto">
                <div class=" overflow-auto grid-cols-9 gap-6 flex w-full h-full p-3">
                    <!-- Column 1 -->
                    <div class="flex flex-col space-y-1 text-center">
                        <div class="pb-1 font-semibold text-lg">Crypto By Market Cap</div>
                        <div id="mc1" class=""></div>
                        <div id="mc2" class=""></div>
                        <div id="mc3" class=""></div>
                        <div id="mc4" class=""></div>
                        <div id="mc5" class=""></div>
                    </div>

                    <!-- Column 2 -->
                    <div class="flex flex-col space-y-1 text-center">
                        <div class="pb-1 font-semibold text-lg">Crypto by 24h Gain</div>
                        <div id="g1" class=""></div>
                        <div id="g2" class=""></div>
                        <div id="g3" class=""></div>
                        <div id="g4" class=""></div>
                        <div id="g5" class=""></div>
                    </div>

                    <!-- Column 3 -->
                    <div class="flex flex-col space-y-1 text-center pr-3">
                        <div class="pb-1 font-semibold text-lg">Crypto by 24h Loss</div>
                        <div id="l1" class=""></div>
                        <div id="l2" class=""></div>
                        <div id="l3" class=""></div>
                        <div id="l4" class=""></div>
                        <div id="l5" class=""></div>
                    </div>

                    <!-- Column 4 -->
                    <div class="flex flex-col space-y-1 text-center">
                        <div class="pb-1 font-semibold text-lg">Diverse Sectors</div>
                        <div id="d1" class=""></div>
                        <div id="d2" class=""></div>
                        <div id="d3" class=""></div>
                        <div id="d4" class=""></div>
                        <div id="d5" class=""></div>
                    </div>

                    <!-- Column 5 -->
                    <div class="flex flex-col space-y-1 text-center">
                        <div class="pb-1 font-semibold text-lg">Recent Hot Stocks</div>
                        <div id="h1" class=""></div>
                        <div id="h2" class=""></div>
                        <div id="h3" class=""></div>
                        <div id="h4" class=""></div>
                        <div id="h5" class=""></div>
                    </div>

                    <!-- Column 6 -->
                    <div class="flex flex-col space-y-1 text-center pr-3">
                        <div class="pb-1 font-semibold text-lg">Top Trending</div>
                        <div id="t1" class=""></div>
                        <div id="t2" class=""></div>
                        <div id="t3" class=""></div>
                        <div id="t4" class=""></div>
                        <div id="t5" class=""></div>
                    </div>

                    <!-- Column 7 -->
                    <div class="flex flex-col space-y-1 text-center">
                        <div class="pb-1 font-semibold text-lg">Top Tech</div>
                        <div id="tt1" class=""></div>
                        <div id="tt2" class=""></div>
                        <div id="tt3" class=""></div>
                        <div id="tt4" class=""></div>
                        <div id="tt5" class=""></div>
                    </div>

                    <!-- Column 8 -->
                    <div class="flex flex-col space-y-1 text-center">
                        <div class="pb-1 font-semibold text-lg">Top EV</div>
                        <div id="te1" class=""></div>
                        <div id="te2" class=""></div>
                        <div id="te3" class=""></div>
                        <div id="te4" class=""></div>
                        <div id="te5" class=""></div>
                    </div>

                    <!-- Column 9 -->
                    <div class="flex flex-col space-y-1 text-center">
                        <div class="pb-1 font-semibold text-lg">Top Chip Makers</div>
                        <div id="tc1" class=""></div>
                        <div id="tc2" class=""></div>
                        <div id="tc3" class=""></div>
                        <div id="tc4" class=""></div>
                        <div id="tc5" class=""></div>
                    </div>
                </div>
            </div>
        </section>
        
        
        

        
        
        
        
    



        <script>
            //Getting 'Indice' prices. These are not actually the indices, they are ETF's (Exchange Traded Funds) that are 1 to 1 in price to the indices.
            function updateIndexPrices() {
                axios.get('https://bladewebsite-99f6caf250e5.herokuapp.com/api/indexPrices')
                    .then((response) => {
                        const data = response.data;
        
                        if (data && Array.isArray(data)) {
                            let html = '';
                            data.forEach((stock) => {
                                const symbol = stock.symbol;
                                const name = stock.name;
                                const price = stock.close;
                                const change24h = stock.change_24h;
        
                                if (change24h < 0) {
                                    html += '<div style="color:red;">';
                                } else {
                                    html += '<div style="color: #54C571;">';
                                }
                                
                                html += `<div>${name} ${change24h.toFixed(2)}%</div>`;
                                html += `</div>`;
                            });
        
                            document.getElementById('index-prices-container').innerHTML = html; // Update the container with index data
                            document.getElementById('dropdown-index-container').innerHTML = html; // Update the container with index data
                        } else {
                            document.getElementById('index-prices-container').innerText = 'Error retrieving index prices.';
                            document.getElementById('dropdown-index-container').innerHTML = html; // Update the container with index data
                        }
                    })
                    .catch((error) => {
                        console.error('Error retrieving index prices:', error);
                        document.getElementById('index-prices-container').innerText = 'Error retrieving index prices.';
                    });
            }

            //function for showing indicies on mobile
            function toggleDropdown() {
                const dropdownContainer = document.getElementById('dropdown-index-container');
                dropdownContainer.classList.toggle('hidden');
            }

            // Function to hide dropdown when screen size is increased
            function hideDropdownOnResize() {
                const screenWidth = window.innerWidth;
                if (screenWidth >= 640) {
                    const dropdownContainer = document.getElementById('dropdown-index-container');
                    dropdownContainer.classList.add('hidden');
                }
            }





            function updateCryptoPrices() {
                axios.get('https://bladewebsite-99f6caf250e5.herokuapp.com/api/cryptodata')
                    .then((response) => {
                        const data = response.data;
                        let count= 0;
                        if (Array.isArray(data) && data.length > 0) {
                            for (let i = 0; i < data.length; i++) { // Loop through the first 5 cryptocurrencies
                                const coin = data[i];
                                const name = coin.name;
                                const symbol = coin.symbol.toUpperCase();
                                const price = coin.current_price;
                                const marketCap = coin.market_cap;
                                const percentChange1h = coin.price_change_percentage_1h_in_currency.toFixed(2);
                                const percentChange24h = coin.price_change_percentage_24h_in_currency.toFixed(2);
                                if (name === 'Tether' || name === 'USDC' || name === 'Lido Staked Ether' || name === 'BNB') {
                                    continue;
                                }

                                // Get the appropriate div element for the current cryptocurrency
                                const cryptoBox = document.getElementById(`mc${count + 1}`); // Update the ID to match the box IDs
                                let color = "";

                                if (percentChange24h < -3) {
                                   color += "E55451";
                                } else if (percentChange24h > 3) {
                                    color += "54C571";
                                } else if(percentChange24h > 0){
                                    color += "A0D6B4";
                                } else{
                                    color += "FFB8BF";
                                }

                                let size = "text-lg";
                                if(name.length + symbol.length + 1 > 13){
                                    size = "text-md";
                                }
                                if(name.length + symbol.length + 1 > 26){
                                    size = "text-sm";
                                }

                                // Check if the box exists before updating its content
                                if (cryptoBox) {
                                    let html = '';
                                    html += `
                                        <div class="w-72 h-24 flex p-1" style="background-color: #${color};">
                                            <div class="flex flex-col w-1/2 h-full items-start justify-center">
                                                <div class="${size}"><strong>${name}</strong> ${symbol}</div>
                                                <div class="font-bold text-xl">$${price.toFixed(2)}</div>
                                            </div>
                                            <div class="flex flex-col w-1/2 h-full items-end text-sm justify-center">
                                                <div>24h: <strong>${percentChange24h}%</strong></div>
                                                <div>1h: <strong>${percentChange1h}%</strong></div>
                                                <div>Market Cap: <strong>${formatMarketCap(marketCap)}</strong></div>
                                            </div>
                                        </div>`;
                                    cryptoBox.innerHTML = html;
                                }
                                count++;

                            }
                        } else {
                            console.error('Error retrieving cryptocurrency prices.');
                        }
                    })
                    .catch((error) => {
                        console.error('Error retrieving cryptocurrency data:', error);
                    });
            }

            function updateTopCryptoPrices() {
                axios.get('https://bladewebsite-99f6caf250e5.herokuapp.com/api/topCryptoData')
                    .then((response) => {
                        const data = response.data;
                        let count = 0;
                        if (Array.isArray(data) && data.length > 0) {
                            // Sort the data based on the percentage change in the last 24 hours
                            data.sort((a, b) => b.price_change_percentage_24h - a.price_change_percentage_24h);
                            // Take the top 10 cryptocurrencies
                            const top5Data = data.slice(0, 5);
                            data.sort((b, a) => b.price_change_percentage_24h - a.price_change_percentage_24h);
                            const worst5Data = data.slice(0, 5);
                            
                            for (let i = 0; i < top5Data.length; i++) {
                                const coin = top5Data[i];
                                const name = coin.name;
                                const symbol = coin.symbol.toUpperCase();
                                const price = coin.current_price;
                                const marketCap = coin.market_cap;
                                const percentChange1h = coin.price_change_percentage_1h_in_currency.toFixed(2);
                                const percentChange24h = coin.price_change_percentage_24h_in_currency.toFixed(2);

                                // Get the appropriate div element for the current cryptocurrency
                                const cryptoBox = document.getElementById(`g${count + 1}`); // Update the ID to match the box IDs
                                let color = "";

                                if (percentChange24h < -3) {
                                   color += "E55451";
                                } else if (percentChange24h > 3) {
                                    color += "54C571";
                                } else if(percentChange24h > 0){
                                    color += "A0D6B4";
                                } else{
                                    color += "FFB8BF";
                                }

                                let size = "text-lg";
                                if(name.length + symbol.length + 1 > 13){
                                    size = "text-md";
                                } if(name.length + symbol.length + 1 > 26){
                                    size = "text-sm";
                                }

                                // Check if the box exists before updating its content
                                if (cryptoBox) {
                                    let html = '';
                                    html += `
                                        <div class="w-72 h-24 flex p-1" style="background-color: #${color};">
                                            <div class="flex flex-col w-1/2 h-full items-start justify-center">
                                                <div class="${size}"><strong>${name}</strong> ${symbol}</div>
                                                <div class="font-bold text-xl">$${price.toFixed(2)}</div>
                                            </div>
                                            <div class="flex flex-col w-1/2 h-full items-end text-sm justify-center">
                                                <div>24h: <strong>${percentChange24h}%</strong></div>
                                                <div>1h: <strong>${percentChange1h}%</strong></div>
                                                <div>Market Cap: <strong>${formatMarketCap(marketCap)}</strong></div>
                                            </div>
                                        </div>`;
                                    cryptoBox.innerHTML = html;
                                }
                                count++;
                            }
                            count = 0;
                            for (let i = 0; i < worst5Data.length; i++) {
                                const coin = top5Data[i];
                                const name = coin.name;
                                const symbol = coin.symbol.toUpperCase();
                                const price = coin.current_price;
                                const marketCap = coin.market_cap;
                                const percentChange1h = coin.price_change_percentage_1h_in_currency.toFixed(2);
                                const percentChange24h = coin.price_change_percentage_24h_in_currency.toFixed(2);

                                // Get the appropriate div element for the current cryptocurrency
                                const cryptoBox = document.getElementById(`l${count + 1}`); // Update the ID to match the box IDs
                                let color = "";

                                if (percentChange24h < -3) {
                                   color += "E55451";
                                } else if (percentChange24h > 3) {
                                    color += "54C571";
                                } else if(percentChange24h > 0){
                                    color += "A0D6B4";
                                } else{
                                    color += "FFB8BF";
                                }

                                let size = "text-lg";
                                if(name.length + symbol.length + 1 > 13){
                                    size = "text-md";
                                } if(name.length + symbol.length + 1 > 26){
                                    size = "text-sm";
                                }

                                // Check if the box exists before updating its content
                                if (cryptoBox) {
                                    let html = '';
                                    html += `
                                        <div class="w-72 h-24 flex p-1" style="background-color: #${color};">
                                            <div class="flex flex-col w-1/2 h-full items-start justify-center">
                                                <div class="${size}"><strong>${name}</strong> ${symbol}</div>
                                                <div class="font-bold text-xl">$${price.toFixed(2)}</div>
                                            </div>
                                            <div class="flex flex-col w-1/2 h-full items-end text-sm justify-center">
                                                <div>24h: <strong>${percentChange24h}%</strong></div>
                                                <div>1h: <strong>${percentChange1h}%</strong></div>
                                                <div>Market Cap: <strong>${formatMarketCap(marketCap)}</strong></div>
                                            </div>
                                        </div>`;
                                    cryptoBox.innerHTML = html;
                                }
                                count++;
                            }
                        } else {
                            console.error('Error retrieving cryptocurrency prices.');
                        }
                    })
                    .catch((error) => {
                        console.error('Error retrieving top cryptocurrency data:', error);
                    });
            }

            
            function formatMarketCap(cap) {
                const abbrev = ['', 'K', 'M', 'B', 'T']; // Add more abbreviations as needed
                const decimals = 2;

                const magnitude = Math.floor(Math.log10(cap) / 3);
                const roundedCap = (cap / Math.pow(1000, magnitude)).toFixed(decimals);

                return `${roundedCap}${abbrev[magnitude]}`;
            }


            updateIndexPrices()
            updateCryptoPrices()
            updateTopCryptoPrices()
            document.getElementById('menu-toggle').addEventListener('click', toggleDropdown);
            window.addEventListener('resize', hideDropdownOnResize); // Listen for screen size changes



        </script>
        


    </body>
</html>
