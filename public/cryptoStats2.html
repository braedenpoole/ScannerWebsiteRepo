<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <title>Scanner</title>

    </head>

    <body class="bg-white">
        <div>
            <!--Navbar-->
            <div id="indicesBar" class="fixed top-0 w-screen justify-center flex items-center space-x-8 h-14 px-5 lg:px-0 drop-shadow-xl bg-black" style="z-index: 999;">
                <!-- Navbar Logo and Hamburger Menu Icon -->
                <div class="items-center">
                    <div class="text-2xl text-white font-semibold hover:bg-gray-700">
                        <a href="https://www.braedenpoole.com/cryptoStats.html" class="px-6 py-2 hover:bg-gray-700" target="_blank">Home</a>
                    </div>
                </div>
                <!--Mobile Indicies-->
                <div id="menu-toggle" class="block md:hidden">
                    <button class="px-6 py-2 hover:bg-gray-700 font-semibold text-2xl">
                        <div class="text-white font-semibold">Indices</div>
                    </button>
                </div>

            
                <!-- Index Prices Container -->
                <div id="index-prices-container" class="hidden justify-end md:flex text-lg font-semibold md:space-x-3 lg:space-x-12 text-center pr-12">
                    <!-- Index prices will be populated here -->
                </div>
            </div>

            <div id="dropdown-index-container" class="pt-14 hidden justify-center w-full bg-black text-lg font-semibol text-center">
                <!-- Index prices will be populated here -->
            </div>
        </div>
        
        <section id="topPage" class="h-screen w-screen bg-red-500 pt-14 flex justify-center items-center">
            <div id="allBoxes" class="w-5/6 h-5/6 bg-blue-400 ">
                  
            </div>
        </section>
        
        
        

        
        
        
        
        
        
        
        











        <script>
            //Getting 'Indice' prices. These are not actually the indices, they are ETF's (Exchange Traded Funds) that are 1 to 1 in price to the indices.
            function updateIndexPrices() {
                axios.get('https://bladewebsite-99f6caf250e5.herokuapp.com/api/indexPrices')
                    .then((response) => {
                        const data = response.data;
        
                        if (data && Array.isArray(data)) {
                            let html = '';
                            data.forEach((stock) => {
                                const symbol = stock.symbol;
                                const name = stock.name;
                                const price = stock.close;
                                const change24h = stock.change_24h;
        
                                if (change24h < 0) {
                                    html += '<div style="color:red;">';
                                } else {
                                    html += '<div style="color: #54C571;">';
                                }
                                
                                html += `<div>${name} ${change24h.toFixed(2)}%</div>`;
                                html += `</div>`;
                            });
        
                            document.getElementById('index-prices-container').innerHTML = html; // Update the container with index data
                            document.getElementById('dropdown-index-container').innerHTML = html; // Update the container with index data
                        } else {
                            document.getElementById('index-prices-container').innerText = 'Error retrieving index prices.';
                            document.getElementById('dropdown-index-container').innerHTML = html; // Update the container with index data
                        }
                    })
                    .catch((error) => {
                        console.error('Error retrieving index prices:', error);
                        document.getElementById('index-prices-container').innerText = 'Error retrieving index prices.';
                    });
            }

            //function for showing indicies on mobile
            function toggleDropdown() {
                const dropdownContainer = document.getElementById('dropdown-index-container');
                dropdownContainer.classList.toggle('hidden');
            }

            // Function to hide dropdown when screen size is increased
            function hideDropdownOnResize() {
                const screenWidth = window.innerWidth;
                if (screenWidth >= 640) {
                    const dropdownContainer = document.getElementById('dropdown-index-container');
                    dropdownContainer.classList.add('hidden');
                }
            }





            function updateCryptoPrices() {
            axios.get('https://bladewebsite-99f6caf250e5.herokuapp.com/api/cryptodata')
                .then((response) => {
                    const data = response.data;

                    if (Array.isArray(data) && data.length > 0) {
                        let html = '';
                        for (let i = 0; i < data.length; i++) {
                            const coin = data[i];
                            const name = coin.name;
                            const symbol = coin.symbol.toUpperCase();
                            const price = coin.current_price;
                            const marketCap = coin.market_cap;
                            const percentChange1h = coin.price_change_percentage_1h_in_currency.toFixed(2);
                            const percentChange24h = coin.price_change_percentage_24h_in_currency.toFixed(2);
                            if (name === 'Tether' || name === 'USDC' || name === 'Lido Staked Ether' || name === 'BNB') {
                                continue;
                            }

                            // Check if the price change is negative or positive
                            const isNegativeChange24h = percentChange24h < 0;

                            // Check if the 24-hour change is very negative or very positive
                            const isVeryNegativeChange24h = percentChange24h < -3;
                            const isVeryPositiveChange24h = percentChange24h > 3;
                            if (isVeryNegativeChange24h) {
                                html += `<div style="color: #E55451;">`;
                            } else if (isVeryPositiveChange24h) {
                                html += `<div style="color: #54C571">`;
                            } else if(percentChange > 0){
                                html += `<div style="color: #A0D6B4">`;
                            } else{
                                html += `<div style="color: #FFB8BF">`;
                            }

                            html += `<div><font size="+1"><strong>${name} </strong></font>${symbol}</div>`;
                            html += `<div><font size="+2"><strong>$${price.toFixed(2)}</strong></font></div>`
                            html += `<div style="text-align:right;">24h: <strong>${percentChange24h}%</strong></div>`;
                            html += `<div style="text-align:right;">1h: <strong>${percentChange1h}%</strong></div>`;
                            html += `<div style="text-align:right;">Market Cap: <strong>$${formatMarketCap(marketCap)}</strong></div>`;
                            html += '</div>';
                        }
                        document.getElementById('crypto-prices').innerHTML = html;
                    } else {
                        document.getElementById('crypto-prices').innerText = 'Error retrieving cryptocurrency prices.';
                    }
                })
                .catch((error) => {
                    console.error('Error retrieving cryptocurrency data:', error);
                    document.getElementById('crypto-prices').innerText = 'Error retrieving cryptocurrency prices.';
                });
            }




            function formatMarketCap(cap) {
                const abbrev = ['', 'K', 'M', 'B', 'T']; // Add more abbreviations as needed
                const decimals = 2;

                const magnitude = Math.floor(Math.log10(cap) / 3);
                const roundedCap = (cap / Math.pow(1000, magnitude)).toFixed(decimals);

                return `${roundedCap}${abbrev[magnitude]}`;
            }




            function updateTopCryptoPrices() {
                axios.get('https://bladewebsite-99f6caf250e5.herokuapp.com/api/topCryptoData')
                    .then((response) => {
                        const data = response.data;

                        if (Array.isArray(data) && data.length > 0) {
                            // Sort the data based on the percentage change in the last 24 hours
                            data.sort((a, b) => b.price_change_percentage_24h - a.price_change_percentage_24h);
                            // Take the top 10 cryptocurrencies
                            const top10Data = data.slice(0, 5);
                            data.sort((b, a) => b.price_change_percentage_24h - a.price_change_percentage_24h);
                            const worst10Data = data.slice(0, 5);


                            let html = '';

                            for (let i = 0; i < top10Data.length; i++) {
                                const coin = top10Data[i];
                                const name = coin.name;
                                const symbol = coin.symbol.toUpperCase();
                                const price = coin.current_price;
                                const marketCap = coin.market_cap;
                                const percentChange1h = coin.price_change_percentage_1h_in_currency.toFixed(2);
                                const percentChange24h = coin.price_change_percentage_24h_in_currency.toFixed(2);

                                const isNegativeChange = percentChange24h < 0;

                                // Add veryRed-bg or veryGreen-bg classes for changes greater than 3%
                                const isVeryNegativeChange = percentChange24h < -3;
                                const isVeryPositiveChange = percentChange24h > 3;
                                if (isVeryNegativeChange24h) {
                                html += `<div style="color: #E55451;">`;
                            } else if (isVeryPositiveChange24h) {
                                html += `<div style="color: #54C571">`;
                            } else if(percentChange > 0){
                                html += `<div style="color: #A0D6B4">`;
                            } else{
                                html += `<div style="color: #FFB8BF">`;
                            }

                                html += `<div><font size="+1"><strong>${name} </strong></font>${symbol}</div>`;
                                html += `<div><strong><font size="+2">$${price.toFixed(2)}</font></strong></div>`;
                                html += `<div style="text-align:right;">24h: <strong>${percentChange24h}%</strong></div>`;
                                html += `<div style="text-align:right;">1h: <strong>${percentChange1h}%</strong></div>`;
                                html += `<div style="text-align:right;">Market Cap: <strong>$${formatMarketCap(marketCap)}</strong></div>`;
                                html += `</div>`;
                            }
                            document.getElementById('top-crypto-prices').innerHTML = html;
                            //clear html
                            html = '';

                            for (let i = 0; i < worst10Data.length; i++) {
                                const coin = worst10Data[i];
                                const name = coin.name;
                                const symbol = coin.symbol.toUpperCase();
                                const price = coin.current_price;
                                const marketCap = coin.market_cap;
                                const percentChange1h = coin.price_change_percentage_1h_in_currency.toFixed(2);
                                const percentChange24h = coin.price_change_percentage_24h_in_currency.toFixed(2);

                                const isNegativeChange = percentChange24h < 0;
                                const bgClass = isNegativeChange ? 'red-bg' : 'green-bg';

                                // Add veryRed-bg or veryGreen-bg classes for changes greater than 3%
                                const isVeryNegativeChange = percentChange24h < -3;
                                const isVeryPositiveChange = percentChange24h > 3;
                                if (isVeryNegativeChange) {
                                    html += `<div class="worstCryptoPrices-box veryRed-bg">`;
                                } else if (isVeryPositiveChange) {
                                    html += `<div class="worstCryptoPrices-box veryGreen-bg">`;
                                } else {
                                    html += `<div class="worstCryptoPrices-box ${bgClass}">`;
                                }

                                html += `<div><font size="+1"><strong>${name} </strong></font>${symbol}</div>`;
                                html += `<div><strong><font size="+2">$${price.toFixed(2)}</font></strong></div>`;
                                html += `<div style="text-align:right;">24h: <strong>${percentChange24h}%</strong></div>`;
                                html += `<div style="text-align:right;">1h: <strong>${percentChange1h}%</strong></div>`;
                                html += `<div style="text-align:right;">Market Cap: <strong>$${formatMarketCap(marketCap)}</strong></div>`;
                                html += `</div>`;
                            }
                            document.getElementById('worst-crypto-prices').innerHTML = html;



                        } else {
                            document.getElementById('top-crypto-prices').innerText = 'Error retrieving cryptocurrency prices.';
                            document.getElementById('worst-crypto-prices').innerText = 'Error retreiving cryptocurrency prices.';
                        }
                    })
                    .catch((error) => {
                        console.error('Error retrieving top cryptocurrency data:', error);
                        document.getElementById('top-crypto-prices').innerText = 'Error retrieving cryptocurrency prices.';
                        document.getElementById('worst-crypto-prices').innerText = 'Error retreiving cryptocurrency prices.';
                    });
            }


            updateIndexPrices()
            document.getElementById('menu-toggle').addEventListener('click', toggleDropdown);
            window.addEventListener('resize', hideDropdownOnResize); // Listen for screen size changes



        </script>
        


    </body>
</html>
