<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>Market Scanner</title>
    <link rel="icon" href="Images/scannerLogo.png" type="image/x-icon">

</head>

<body class="bg-gray-300">
<div>
    <div id="indicesBar"
         class="fixed top-0 w-screen justify-center flex items-center space-x-8 h-14 px-5 lg:px-0 drop-shadow-xl bg-black"
         style="z-index: 999;">
        <div class="items-center">
            <div class="text-2xl text-white font-semibold hover:bg-gray-700">
                <a href="https://www.braedenpoole.com/index.html" class="px-6 py-2 hover:bg-gray-700" target="_blank">My
                    Portfolio</a>
            </div>
        </div>
        <div id="menu-toggle" class="block md:hidden">
            <button class="px-6 py-2 hover:bg-gray-700 font-semibold text-2xl">
                <div class="text-white font-semibold">Indices</div>
            </button>
        </div>


        <div id="index-prices-container"
             class="hidden justify-end md:flex text-lg font-semibold md:space-x-3 lg:space-x-12 text-center pr-12">
        </div>
    </div>

    <div id="dropdown-index-container"
         class="pt-14 hidden justify-center w-full bg-black text-lg font-semibol text-center" style="z-index: 998;">
    </div>
</div>

<div class="text-xl font-bold text-center pt-16 bg-gray-300">Cryptocurrency Data</div>

<section id="topPage" class="h-full w-full overflow-auto bg-gray-300 pt-2 flex justify-center items-center">
    <div id="cryptoBoxesContainer"
         class="h-3/4 w-5/6 md:h-5/6 bg-gray-300 flex justify-center items-center overflow-auto">
        <div class=" overflow-auto grid-cols-10 gap-6 flex w-full h-full p-3">
            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top Market Cap</div>
                <div id="mc1" class=""></div>
                <div id="mc2" class=""></div>
                <div id="mc3" class=""></div>
                <div id="mc4" class=""></div>
                <div id="mc5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Largest 24h Gain</div>
                <div id="g1" class=""></div>
                <div id="g2" class=""></div>
                <div id="g3" class=""></div>
                <div id="g4" class=""></div>
                <div id="g5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Largest 24h Loss</div>
                <div id="l1" class=""></div>
                <div id="l2" class=""></div>
                <div id="l3" class=""></div>
                <div id="l4" class=""></div>
                <div id="l5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Largest 1h Gain</div>
                <div id="lg1" class=""></div>
                <div id="lg2" class=""></div>
                <div id="lg3" class=""></div>
                <div id="lg4" class=""></div>
                <div id="lg5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Largest 1h Loss</div>
                <div id="ll1" class=""></div>
                <div id="ll2" class=""></div>
                <div id="ll3" class=""></div>
                <div id="ll4" class=""></div>
                <div id="ll5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top AI</div>
                <div id="ai1" class=""></div>
                <div id="ai2" class=""></div>
                <div id="ai3" class=""></div>
                <div id="ai4" class=""></div>
                <div id="ai5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top Meme</div>
                <div id="m1" class=""></div>
                <div id="m2" class=""></div>
                <div id="m3" class=""></div>
                <div id="m4" class=""></div>
                <div id="m5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top Gaming</div>
                <div id="tg1" class=""></div>
                <div id="tg2" class=""></div>
                <div id="tg3" class=""></div>
                <div id="tg4" class=""></div>
                <div id="tg5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top DeFi</div>
                <div id="df1" class=""></div>
                <div id="df2" class=""></div>
                <div id="df3" class=""></div>
                <div id="df4" class=""></div>
                <div id="df5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top Layer 2's</div>
                <div id="tl1" class=""></div>
                <div id="tl2" class=""></div>
                <div id="tl3" class=""></div>
                <div id="tl4" class=""></div>
                <div id="tl5" class=""></div>
            </div>
        </div>
    </div>
</section>

<div class="h-2 bg-gray-300"></div>
<div class="h-4 w-full bg-gray-300 flex justify-center text-center">
    <div class="pr-4 text-right w-1/4 text-xs font-semibold">24 Hour Negative</div>
    <div class="w-1/2 h-full" style="background:linear-gradient(to right, #E55451, #FFB8BF, #A0D6B4, #54C571 )"></div>
    <div class="pl-4 text-left w-1/4 text-xs font-semibold">24 Hour Positive</div>
</div>

<div class="text-xl font-bold pt-10 text-center bg-gray-300">Stock Market Data</div>
<section id="secondPage" class="h-full w-full overflow-auto bg-gray-300 pt-2 flex justify-center items-center">

    <div id="stockBoxesContainer"
         class="h-3/4 w-5/6 md:h-5/6 bg-gray-300 flex justify-center items-center overflow-auto">
        <div class=" overflow-auto grid-cols-8 gap-6 flex w-full h-full p-3">
            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top Tech</div>
                <div id="toptech1" class=""></div>
                <div id="toptech2" class=""></div>
                <div id="toptech3" class=""></div>
                <div id="toptech4" class=""></div>
                <div id="toptech5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top EV</div>
                <div id="ev1" class=""></div>
                <div id="ev2" class=""></div>
                <div id="ev3" class=""></div>
                <div id="ev4" class=""></div>
                <div id="ev5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center pr-5">
                <div class="pb-1 font-semibold text-lg">Top Chip Makers</div>
                <div id="cm1" class=""></div>
                <div id="cm2" class=""></div>
                <div id="cm3" class=""></div>
                <div id="cm4" class=""></div>
                <div id="cm5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top Crypto Miners</div>
                <div id="miner1" class=""></div>
                <div id="miner2" class=""></div>
                <div id="miner3" class=""></div>
                <div id="miner4" class=""></div>
                <div id="miner5" class=""></div>
            </div>

            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top AI</div>
                <div id="aistock1" class=""></div>
                <div id="aistock2" class=""></div>
                <div id="aistock3" class=""></div>
                <div id="aistock4" class=""></div>
                <div id="aistock5" class=""></div>
            </div>
            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top Energy</div>
                <div id="te1" class=""></div>
                <div id="te2" class=""></div>
                <div id="te3" class=""></div>
                <div id="te4" class=""></div>
                <div id="te5" class=""></div>
            </div>
            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top Banking</div>
                <div id="tb1" class=""></div>
                <div id="tb2" class=""></div>
                <div id="tb3" class=""></div>
                <div id="tb4" class=""></div>
                <div id="tb5" class=""></div>
            </div>
            <div class="flex flex-col space-y-1 text-center">
                <div class="pb-1 font-semibold text-lg">Top Health</div>
                <div id="th1" class=""></div>
                <div id="th2" class=""></div>
                <div id="th3" class=""></div>
                <div id="th4" class=""></div>
                <div id="th5" class=""></div>
            </div>
        </div>
    </div>
</section>

<div class="h-2 bg-gray-300"></div>
<div class="h-4 w-full bg-gray-300 flex justify-center text-center">
    <div class="pr-4 text-right w-1/4 text-xs font-semibold">24 Hour Negative</div>
    <div class="w-1/2 h-full" style="background:linear-gradient(to right, #E55451, #FFB8BF, #A0D6B4, #54C571 )"></div>
    <div class="pl-4 text-left w-1/4 text-xs font-semibold">24 Hour Positive</div>
</div>

<section>
    <div class="pr-8 pl-8 md:pr-36 md:pl-36 lg:pr-72 lg:pl-72 pt-12 pb-6">
        <div class="text-xl font-bold pb-6 text-center">Check Out Other Stocks!</div>
        <div class="tradingview-widget-copyright">
            <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
                <span class="blue-text">Track all markets on TradingView</span>
            </a>
        </div>
        <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
        <script type="text/javascript">
            new TradingView.widget({
                "symbol": "NASDAQ:MARA",
                "interval": "D",
                "timezone": "Etc/UTC",
                "theme": "light",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "allow_symbol_change": true,
                "width": "full",
                "height": "500"
            });
        </script>
        <br/><br/>
    </div>
</section>

<section>
    <div class="w-full h-24 flex items-center justify-center bg-black">
        <div class="text-white text-xl font-semibold text-center">
            Crypto data brought to you by CoinGecko | Stock data brought to you by Finnhub
        </div>
    </div>
</section>

<script>
    const API_BASE_URL = 'https://bladewebsite-99f6caf250e5.herokuapp.com';

    function updateIndexPrices() {
        axios.get(`${API_BASE_URL}/api/indices`)
             .then((response) => {
                 const data = response.data;

                 if (data && Array.isArray(data)) {
                     let html = '';
                     data.forEach((stock) => {
                         const change24h = stock.change_24h;
                         const color = change24h < 0 ? 'red' : '#54C571';
                         html += `<div style="color:${color};"><div>${stock.name} ${change24h.toFixed(2)}%</div></div>`;
                     });

                     document.getElementById('index-prices-container').innerHTML = html;
                     document.getElementById('dropdown-index-container').innerHTML = html;
                 } else {
                     document.getElementById('index-prices-container').innerText = 'Error retrieving index prices.';
                 }
             })
             .catch((error) => {
                 console.error('Error retrieving index prices:', error);
                 document.getElementById('index-prices-container').innerText = 'Error retrieving index prices.';
             });
    }

    function toggleDropdown() {
        document.getElementById('dropdown-index-container').classList.toggle('hidden');
        document.getElementById('dropdown-index-container').classList.toggle('fixed');
    }

    function hideDropdownOnResize() {
        if (window.innerWidth >= 640) {
            document.getElementById('dropdown-index-container').classList.add('hidden');
        }
    }

    function formatMarketCap(cap) {
        if (cap === null || cap === undefined) return 'N/A';
        if (cap >= 1.0e+12) return `$${(cap / 1.0e+12).toFixed(2)}T`;
        if (cap >= 1.0e+9) return `$${(cap / 1.0e+9).toFixed(2)}B`;
        if (cap >= 1.0e+6) return `$${(cap / 1.0e+6).toFixed(2)}M`;
        return `$${cap.toLocaleString()}`;
    }

    function createCryptoHTML(coin, use1hChangeForColor = false) {
        const { name, symbol, current_price: price, market_cap: marketCap, price_change_percentage_1h_in_currency: pc1h, price_change_percentage_24h_in_currency: pc24h } = coin;

        const percentChange1h = pc1h ? pc1h.toFixed(2) : 'N/A';
        const percentChange24h = pc24h ? pc24h.toFixed(2) : 'N/A';

        const changeForColor = use1hChangeForColor ? parseFloat(percentChange1h) : parseFloat(percentChange24h);
        let color = "FFB8BF"; // Default soft red
        if (changeForColor > 3) color = "54C571";      // Strong green
        else if (changeForColor > 0) color = "A0D6B4"; // Soft green
        else if (changeForColor < -3) color = "E55451"; // Strong red

        let size = "text-lg";
        if (name.length + symbol.length > 20) size = "text-sm";
        else if (name.length + symbol.length > 13) size = "text-md";

        return `
                    <div class="w-72 h-24 flex p-1" style="background-color: #${color};">
                        <div class="flex flex-col w-1/2 h-full items-start justify-center">
                            <div class="${size}"><strong>${name}</strong> ${symbol.toUpperCase()}</div>
                            <div class="font-bold text-xl">$${price ? price.toFixed(2) : 'N/A'}</div>
                        </div>
                        <div class="flex flex-col w-1/2 h-full items-end text-sm justify-center">
                            <div>24h: <strong>${percentChange24h}%</strong></div>
                            <div>1h: <strong>${percentChange1h}%</strong></div>
                            <div>Market Cap: <strong>${formatMarketCap(marketCap)}</strong></div>
                        </div>
                    </div>`;
    }

    function populateCryptoCategory(data, categoryPrefix, coinIds) {
        const filteredData = coinIds.map(id => data.find(coin => coin.id === id)).filter(Boolean); // Find coins by ID and remove any not found
        for (let i = 0; i < 5; i++) {
            const coin = filteredData[i];
            const box = document.getElementById(`${categoryPrefix}${i + 1}`);
            if (box && coin) {
                box.innerHTML = createCryptoHTML(coin);
            } else if (box) {
                box.innerHTML = '<div class="w-72 h-24 flex p-1 bg-gray-400 items-center justify-center">Data Unavailable</div>';
            }
        }
    }

    function updateCryptoData() {
        axios.get(`${API_BASE_URL}/api/crypto`)
             .then(response => {
                 const data = response.data;
                 if (!Array.isArray(data) || data.length === 0) {
                     console.error('Invalid or empty crypto data received from API.');
                     return;
                 }

                 // Top Market Cap (filter out stablecoins and wrapped assets)
                 const topMC = data.filter(c => !['tether', 'usd-coin', 'lido-staked-ether'].includes(c.id)).slice(0, 5);
                 topMC.forEach((coin, i) => document.getElementById(`mc${i + 1}`).innerHTML = createCryptoHTML(coin));

                 // 24h Gainers
                 const gainers24h = [...data].sort((a, b) => (b.price_change_percentage_24h_in_currency || -Infinity) - (a.price_change_percentage_24h_in_currency || -Infinity)).slice(0, 5);
                 gainers24h.forEach((coin, i) => document.getElementById(`g${i + 1}`).innerHTML = createCryptoHTML(coin));

                 // 24h Losers
                 const losers24h = [...data].sort((a, b) => (a.price_change_percentage_24h_in_currency || Infinity) - (b.price_change_percentage_24h_in_currency || Infinity)).slice(0, 5);
                 losers24h.forEach((coin, i) => document.getElementById(`l${i + 1}`).innerHTML = createCryptoHTML(coin));

                 // 1h Gainers
                 const gainers1h = [...data].sort((a, b) => (b.price_change_percentage_1h_in_currency || -Infinity) - (a.price_change_percentage_1h_in_currency || -Infinity)).slice(0, 5);
                 gainers1h.forEach((coin, i) => document.getElementById(`lg${i + 1}`).innerHTML = createCryptoHTML(coin, true));

                 // 1h Losers
                 const losers1h = [...data].sort((a, b) => (a.price_change_percentage_1h_in_currency || Infinity) - (b.price_change_percentage_1h_in_currency || Infinity)).slice(0, 5);
                 losers1h.forEach((coin, i) => document.getElementById(`ll${i + 1}`).innerHTML = createCryptoHTML(coin, true));

                 // Populate categories by CoinGecko ID
                 populateCryptoCategory(data, 'ai', ['bittensor', 'render-token', 'fetch-ai', 'singularitynet', 'akash-network']);
                 populateCryptoCategory(data, 'm', ['dogecoin', 'shiba-inu', 'pepe', 'bonk', 'dogwifcoin']);
                 populateCryptoCategory(data, 'tg', ['immutable-x', 'beam-2', 'the-sandbox', 'gala', 'axie-infinity']);
                 populateCryptoCategory(data, 'df', ['uniswap', 'chainlink', 'dai', 'the-graph', 'havven']);
                 populateCryptoCategory(data, 'tl', ['matic-network', 'optimism', 'mantle', 'arbitrum', 'starknet']);
             })
             .catch(error => console.error('Error fetching crypto data:', error));
    }

    function createStockHTML(stock) {
        const { name, symbol, close, change_24h, hod, lod } = stock;
        const change24h = change_24h ? change_24h.toFixed(2) : 'N/A';

        let color = "FFB8BF"; // Default soft red
        if (parseFloat(change24h) > 3) color = "54C571";
        else if (parseFloat(change24h) > 0) color = "A0D6B4";
        else if (parseFloat(change24h) < -3) color = "E55451";

        let size = "text-lg";
        if (name.length + symbol.length > 20) size = "text-sm";
        else if (name.length + symbol.length > 13) size = "text-md";

        return `
                    <div class="w-72 h-24 flex p-1" style="background-color: #${color};">
                        <div class="flex flex-col w-1/2 h-full items-start justify-center">
                            <div class="${size}"><strong>${name}</strong> ${symbol.toUpperCase()}</div>
                            <div class="font-bold text-xl">$${close ? close.toFixed(2) : 'N/A'}</div>
                        </div>
                        <div class="flex flex-col w-1/2 h-full items-end text-sm justify-center">
                            <div>24h: <strong>${change24h}%</strong></div>
                            <div>High: <strong>$${hod ? hod.toFixed(2) : 'N/A'}</strong></div>
                            <div>Low: <strong>$${lod ? lod.toFixed(2) : 'N/A'}</strong></div>
                        </div>
                    </div>`;
    }

    function updateStockPrices() {
        axios.get(`${API_BASE_URL}/api/TechPrices`)
             .then(response => {
                 const data = response.data;
                 if (!Array.isArray(data) || data.length === 0) {
                     console.error('Invalid or empty stock data received.');
                     return;
                 }

                 const categories = {
                     'toptech': data.slice(0, 5), 'ev': data.slice(5, 10),
                     'cm': data.slice(10, 15), 'miner': data.slice(15, 20),
                     'aistock': data.slice(20, 25), 'te': data.slice(25, 30),
                     'tb': data.slice(30, 35), 'th': data.slice(35, 40)
                 };

                 for (const prefix in categories) {
                     categories[prefix].forEach((stock, i) => {
                         const box = document.getElementById(`${prefix}${i + 1}`);
                         if (box) box.innerHTML = createStockHTML(stock);
                     });
                 }
             })
             .catch(error => console.error('Error fetching stock prices:', error));
    }

    // Initial calls
    updateIndexPrices();
    updateCryptoData();
    updateStockPrices();

    // Set intervals to refresh data every 5 minutes
    setInterval(updateIndexPrices, 300000);
    setInterval(updateCryptoData, 300000);
    setInterval(updateStockPrices, 300000);

    // Event Listeners
    document.getElementById('menu-toggle').addEventListener('click', toggleDropdown);
    window.addEventListener('resize', hideDropdownOnResize);
</script>
</body>
</html>